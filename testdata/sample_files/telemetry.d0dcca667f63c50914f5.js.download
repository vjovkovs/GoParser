(self.webpackChunk_klaviyo_onsite_modules=self.webpackChunk_klaviyo_onsite_modules||[]).push([[7913],{47849:function(e,t,n){"use strict";n.d(t,{P:function(){return r},f:function(){return i}});const r="triggering-state-update";class i extends CustomEvent{constructor(e){super(r,{detail:e})}}},94988:function(e,t,n){"use strict";n.d(t,{Gi:function(){return a},KS:function(){return i}});var r=n(12276);class i extends CustomEvent{constructor(e){super(r.Rc,{detail:e})}}const o=[],s=e=>{const t=new i(e);window.dispatchEvent(t)},a=e=>{if(window.onsiteTelemetryLoaded){for(;o.length>0;){const e=o.shift();e&&s(e)}s(e)}else o.push(e)}},12276:function(e,t,n){"use strict";n.d(t,{Rc:function(){return r},T4:function(){return s},Xf:function(){return o},lv:function(){return i}});const r="ONSITE_TELEMETRICS_EVENT",i="visitor-tracking",o="signup-forms",s="onsite_visitor_tracking"},88176:function(e,t,n){"use strict";n.d(t,{UF:function(){return U},mq:function(){return x},oO:function(){return j},rN:function(){return B}});const r="qualify",i="open",o="close",s="closeTeaser",a="submit",c="stepSubmit",u="embedOpen",d="redirectedToUrl",l="subscribedViaSMS",f="subscribedViaWhatsApp",v="failedAgeGate",p="viewedStep",m="redirectedToUrlFromStep",g="submitOptInCode",y="triggeredBotProtection",w="falsePositiveBotProtection",_="requestBlockedByWAF",h="redirectedToDeepLink",S="clickedRedirectToInbox",E="hideRedirectToInbox",b="failedToRedirectToInbox",k="submitBackInStockForm",T="dynamicButtonBackInStockClicked",I="dynamicButtonBackInStockPlaced",O="submitBackInStockStep",j="klaviyojsSessionStarted",x="userIdentified",B={[r]:"qualifyModal",[i]:"openModal",[o]:"closeModal",[s]:"closeTeaser",[a]:"submitModal",[c]:"stepSubmit",errorView:"showErrorView",[u]:"loadedEmbed",[d]:"redirectedToUrl",[l]:"subscribedViaSMS",submitRateLimit:"submitRateLimit",klaviyoBranding:"clickedKlaviyoBranding",showEmailField:"showEmailField",showShopLogin:"showShopLogin",shopLoginSuccess:"shopLoginSuccess",[v]:"failedAgeGate",[p]:"viewedStep",[m]:"redirectedToUrlFromStep",[g]:"submitOptInCode",resendOptInCode:"resendOptInCode",openFormActionFormOpened:"openFormActionFormOpened",[y]:"triggeredBotProtection",[w]:"falsePositiveBotProtection",[_]:"requestBlockedByWAF",submitSpinToWin:"submitSpinToWin",receivedOutcomeView:"receivedOutcomeView",receivedOutcomeViewAndCouponCode:"receivedOutcomeViewAndCouponCode",[h]:"redirectedToDeepLink",[S]:S,[E]:E,[b]:b,[k]:"submitBackInStockForm",[T]:"dynamicButtonBackInStockClicked",[I]:"dynamicButtonBackInStockPlaced",[O]:"submitBackInStockStep",[j]:j,[x]:x,[f]:"subscribedViaWhatsApp"},C="viewed_form",P="engaged_with_form",H="submitted_form_step",L="bot_protection",U={[r]:"qualified_form",[i]:C,[o]:"closed_form",[s]:"closed_teaser",[u]:C,[a]:P,[d]:P,[l]:P,[g]:P,[v]:"failed_age_gate",[p]:"viewed_form_step",[c]:H,[m]:H,[y]:L,[w]:L,[_]:L,[h]:P,[k]:"submitted_back_in_stock_form",[T]:"dynamic_button_back_in_stock_clicked",[I]:"dynamic_button_back_in_stock_placed",[O]:"submitted_back_in_stock_form_step",[j]:"klaviyojs_session_started",[x]:"user_identified",[f]:P}},53236:function(e,t,n){"use strict";var r=n(12276),i=n(88176),o=n(47849),s=n(25598),a=n(84509),c=n(46456),u=n(27655),d=function(){return u.Z.Date.now()},l=/\s/;var f=function(e){for(var t=e.length;t--&&l.test(e.charAt(t)););return t},v=/^\s+/;var p=function(e){return e?e.slice(0,f(e)+1).replace(v,""):e},m=n(11412),g=/^[-+]0x[0-9a-f]+$/i,y=/^0b[01]+$/i,w=/^0o[0-7]+$/i,_=parseInt;var h=function(e){if("number"==typeof e)return e;if((0,m.Z)(e))return NaN;if((0,c.Z)(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=(0,c.Z)(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=p(e);var n=y.test(e);return n||w.test(e)?_(e.slice(2),n?2:8):g.test(e)?NaN:+e},S=Math.max,E=Math.min;var b=function(e,t,n){var r,i,o,s,a,u,l=0,f=!1,v=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var n=r,o=i;return r=i=void 0,l=t,s=e.apply(o,n)}function g(e){return l=e,a=setTimeout(w,t),f?m(e):s}function y(e){var n=e-u;return void 0===u||n>=t||n<0||v&&e-l>=o}function w(){var e=d();if(y(e))return _(e);a=setTimeout(w,function(e){var n=t-(e-u);return v?E(n,o-(e-l)):n}(e))}function _(e){return a=void 0,p&&r?m(e):(r=i=void 0,s)}function b(){var e=d(),n=y(e);if(r=arguments,i=this,u=e,n){if(void 0===a)return g(u);if(v)return clearTimeout(a),a=setTimeout(w,t),m(u)}return void 0===a&&(a=setTimeout(w,t)),s}return t=h(t)||0,(0,c.Z)(n)&&(f=!!n.leading,o=(v="maxWait"in n)?S(h(n.maxWait)||0,t):o,p="trailing"in n?!!n.trailing:p),b.cancel=function(){void 0!==a&&clearTimeout(a),l=0,r=u=i=a=void 0},b.flush=function(){return void 0===a?s:_(d())},b},k=n(5645),T=n.n(k),I=(n(92461),n(60873),n(87100)),O=n(83187),j=n(93648),x=n(71721),B=n(22314),C=n(12948),P=n(75902),H=n(19568);const L="__kla_session",U=(()=>{const e="https:"===window.location.protocol;return{path:"/",sameSite:e?"None":"Lax",secure:e}})(),N=(e,t)=>{(0,P.zP)(e,t,1800,Object.assign({},U))},M=async({updateExpiryTime:e=!0,_isRecoveryAttempt:t=!1}={})=>{if(!await(async()=>{var e,t;if("true"===(0,P.ej)("__kla_off"))return!1;const n=null==(e=window.Shopify)||null==(e=e.customerPrivacy)||null==e.userCanBeTracked?void 0:e.userCanBeTracked(),r=await(null==(t=window.klaviyo)||null==t.account?void 0:t.account()),i="string"==typeof r&&r.length>0;return n||i})())return;const n=(0,P.ej)(L);if(!n){const e={sessionId:(0,H.V)(),sentSessionStartedEvent:!1,sentUserIdentifiedEvent:!1};return r=L,i=JSON.stringify(e),(0,P.d8)(r,i,1800,Object.assign({},U)),e}var r,i;try{e&&N(L,n);const r=JSON.parse(n);if((e=>"object"==typeof e&&null!==e&&"sessionId"in e&&"string"==typeof e.sessionId&&"sentSessionStartedEvent"in e&&"boolean"==typeof e.sentSessionStartedEvent&&"sentUserIdentifiedEvent"in e&&"boolean"==typeof e.sentUserIdentifiedEvent)(r))return r;if(!t)return(0,s.Yd)("Malformed session cookie detected, attempting recovery"),(e=>{(0,P.kT)(e,Object.assign({},U))})(L),M({updateExpiryTime:e,_isRecoveryAttempt:!0});throw new Error(`Malformed session cookie: ${r}`)}catch(e){return void(0,s.Yd)("Error parsing session cookie",{error:e,stack:e instanceof Error?e.stack:void 0})}};let R=Promise.resolve(!1);const $=({sentSessionStartedEvent:e=!1,sentUserIdentifiedEvent:t=!1})=>(R=R.then((async()=>{const n=await M({updateExpiryTime:!1});if(!n)return!1;const r=Object.assign({},n);let i=!1;return e&&!n.sentSessionStartedEvent&&(r.sentSessionStartedEvent=!0,i=!0),t&&!n.sentUserIdentifiedEvent&&(r.sentUserIdentifiedEvent=!0,i=!0),i&&N(L,JSON.stringify(r)),i})).catch((e=>((0,s.Yd)("Error updating session cookie",{error:e,stack:null==e?void 0:e.stack}),!1))),R),A=["formId","form_id"],F=async(e,t)=>{const n=(0,j.$j)(window.location.toString()),r=(0,x.af)(),o=(0,x.FU)(),s=(0,B.Z)()?"MOBILE":"DESKTOP",a=Object.keys(i.rN),c=Object.values(i.rN),u=t?await(async({updateExpiryTime:e=!0}={})=>{const t=await M({updateExpiryTime:e});return null==t?void 0:t.sessionId})():void 0;return e.map((e=>{var t,d,l,f,v,p;const m=(e=>e in i.rN)(e.metric)?i.rN[e.metric]:e.metric;if(!a.includes(m)&&!c.includes(m))throw new Error(`Invalid metric: ${m}`);const g=i.UF[e.metric],y=e.eventDetails||{},{formId:w,form_id:_}=y,h=T()(y,A),S=null!=w?w:_;return{metric:m,metric_service_event_name:null!=(t=e.metricServiceEventName)?t:g,log_to_statsd:null==(d=e.logToStatsd)||d,statsd_info:e.statsdInfo,log_to_s3:null==(l=e.logToS3)||l,log_to_metrics_service:null!=(f=e.logToMetricsService)?f:!!g,event_details:Object.assign({},h,n,{form_id:S,device_type:s,hostname:window.location.hostname,href:window.location.href,page_url:`${window.location.origin}${window.location.pathname}`,first_referrer:null==o||null==(v=o.$referrer)?void 0:v.first_page,referrer:null==o||null==(p=o.$last_referrer)?void 0:p.first_page,user_agent:navigator.userAgent,locale:navigator.language},r||{},{klaviyo_js_session_id:u})}}))},q=async e=>{const{metricGroup:t,events:n,companyId:i,sample:o=1,useSession:s=!0}=e.detail;try{const e=await F(n,s),a=await(({metricGroup:e,events:t,companyId:n,sample:r=1})=>Math.random()>r?Promise.resolve(null):(0,I.Z)(`https://a.klaviyo.com/onsite/track-analytics?company_id=${n}`,{method:"POST",mode:"no-cors",body:JSON.stringify((0,O.Y)({metricGroup:e,events:t})),headers:{"Content-Type":"application/json",accept:"application/json"}}))({metricGroup:t||r.Xf,companyId:i,sample:o,events:e});return a}catch(e){return((e,t)=>{const n="undefined"!=typeof ProgressEvent&&e instanceof ProgressEvent||void 0!==window.XMLHttpRequestProgressEvent&&e instanceof window.XMLHttpRequestProgressEvent,r=e instanceof Error;!n&&r&&(0,C.T)(e,{tags:{logMetric:"True"},extra:{events:t}})})(e,n),null}};var z=n(94988);const Y=()=>{const e=window.klaviyoModulesObject;return null==e?void 0:e.companyId},V=(e,t,n)=>{var r;if(!i.UF[e])return null;const o=null==(r=(0,x.zy)())?void 0:r.$exchange_id;return[Object.assign({metric:e,metricServiceEventName:i.UF[e],logToMetricsService:!0,logToS3:!0,logToStatsd:!0,statsdInfo:void 0},n,{eventDetails:{exchangeId:o,isIdentified:t.isIdentified,isClient:!0}})]};var Z=new class{constructor(){this._eventHandlers=new Map}get eventHandlers(){return this._eventHandlers}registerEventHandler(e,t,n){this._eventHandlers.has(e)&&this.unregisterEventHandler(e),this._eventHandlers.set(e,{eventType:t,callback:n}),window.addEventListener(t,n)}unregisterEventHandler(e){const t=this._eventHandlers.get(e);t&&(this._eventHandlers.delete(e),window.removeEventListener(t.eventType,t.callback))}clear(){for(const e of this._eventHandlers.values())window.removeEventListener(e.eventType,e.callback);this._eventHandlers.clear()}};const K="sentSessionStartedEvent";let G=!1;const J=()=>{if(G)return!0;try{var e;return JSON.parse(null!=(e=sessionStorage.getItem(K))?e:"false")}catch(e){return(0,s.Yd)(`Error getting session started event in session storage: ${e}`),!0}},W="sentUserIdentifiedEvent";let D=!1;const X=()=>{if(D)return!0;try{var e;return JSON.parse(null!=(e=sessionStorage.getItem(W))?e:"false")}catch(e){return(0,s.Yd)(`Error getting user identified event in session storage: ${e}`),!0}},Q=e=>{let t=!1;return b((async n=>{if(!t){t=!0;try{await e(n)}catch(e){(0,s.Yd)("Error visitor tracking event handler",{error:e,stack:e instanceof Error?e.stack:void 0})}finally{t=!1}}}),500)},ee=Q((async({detail:e})=>{if(J())return void Z.unregisterEventHandler(i.oO);if(!(({visitedUrls:e,elapsedTime:t,scrollPercentage:n})=>e.length>=2||t>=1e4||n>=50)(e.state))return;if(!await $({sentSessionStartedEvent:!0}))return;const t=r.lv,n=Y(),o=V(i.oO,e.state);if(!o||!n)return;const a=new z.KS({metricGroup:t,companyId:n,events:o});window.dispatchEvent(a),(e=>{G=e;try{sessionStorage.setItem(K,JSON.stringify(e))}catch(e){(0,s.Yd)(`Error setting session started event in session storage: ${e}`)}})(!0),Z.unregisterEventHandler(i.oO),(0,s.Yd)(`Session started event sent. Unregistering event handler. Event handlers remaining: ${Z.eventHandlers.size}`)})),te=Q((async({detail:e})=>{if(X())return void Z.unregisterEventHandler(i.mq);if(!e.state.isIdentified)return;if(!await $({sentUserIdentifiedEvent:!0}))return;const t=r.lv,n=Y(),o=V(i.mq,e.state);if(!o||!n)return;const a=new z.KS({metricGroup:t,companyId:n,events:o});window.dispatchEvent(a),(e=>{D=e;try{sessionStorage.setItem(W,JSON.stringify(e))}catch(e){(0,s.Yd)(`Error setting user identified event in session storage: ${e}`)}})(!0),Z.unregisterEventHandler(i.mq),(0,s.Yd)(`User identified event sent. Unregistering event handler. Event handlers remaining: ${Z.eventHandlers.size}`)})),ne=()=>{(0,a.O)(r.T4)&&(Z.clear(),window.onsiteTelemetryLoaded=!1)};let re=!1;const ie=async()=>{if(re)(0,s.Yd)("Telemetry already initialized, skipping.");else{re=!0;try{if(ne(),!(0,a.O)(r.T4))return;Z.registerEventHandler(r.Rc,r.Rc,q);const e=await M({updateExpiryTime:!1}),t=!1===(null==e?void 0:e.sentSessionStartedEvent)&&!J(),n=!1===(null==e?void 0:e.sentUserIdentifiedEvent)&&!X();t&&Z.registerEventHandler(i.oO,o.P,ee),n&&Z.registerEventHandler(i.mq,o.P,te),window.onsiteTelemetryLoaded=!0}catch(e){(0,s.Yd)("Error during onsite telemetry setup",{error:e,stack:e instanceof Error?e.stack:void 0}),ne()}}};(async()=>{ie()})()},51311:function(e,t,n){var r,i,o,s,a,c,u,d,l,f,v,p,m,g,y,w;o=function(e,t,n){if(!l(t)||v(t)||p(t)||m(t)||d(t))return t;var r,i=0,s=0;if(f(t))for(r=[],s=t.length;i<s;i++)r.push(o(e,t[i],n));else for(var a in r={},t)Object.prototype.hasOwnProperty.call(t,a)&&(r[e(a,n)]=o(e,t[a],n));return r},s=function(e){return g(e)?e:(e=e.replace(/[\-_\s]+(.)?/g,(function(e,t){return t?t.toUpperCase():""}))).substr(0,1).toLowerCase()+e.substr(1)},a=function(e){var t=s(e);return t.substr(0,1).toUpperCase()+t.substr(1)},c=function(e,t){return function(e,t){var n=(t=t||{}).separator||"_",r=t.split||/(?=[A-Z])/;return e.split(r).join(n)}(e,t).toLowerCase()},u=Object.prototype.toString,d=function(e){return"function"==typeof e},l=function(e){return e===Object(e)},f=function(e){return"[object Array]"==u.call(e)},v=function(e){return"[object Date]"==u.call(e)},p=function(e){return"[object RegExp]"==u.call(e)},m=function(e){return"[object Boolean]"==u.call(e)},g=function(e){return(e-=0)==e},y=function(e,t){var n=t&&"process"in t?t.process:t;return"function"!=typeof n?e:function(t,r){return n(t,e,r)}},w={camelize:s,decamelize:c,pascalize:a,depascalize:c,camelizeKeys:function(e,t){return o(y(s,t),e)},decamelizeKeys:function(e,t){return o(y(c,t),e,t)},pascalizeKeys:function(e,t){return o(y(a,t),e)},depascalizeKeys:function(){return this.decamelizeKeys.apply(this,arguments)}},void 0===(i="function"==typeof(r=w)?r.call(t,n,t,e):r)||(e.exports=i)},11412:function(e,t,n){"use strict";var r=n(24393),i=n(47256);t.Z=function(e){return"symbol"==typeof e||(0,i.Z)(e)&&"[object Symbol]"==(0,r.Z)(e)}},87100:function(e,t,n){"use strict";function r(e,t){return t=t||{},new Promise((function(n,r){var i=new XMLHttpRequest,o=[],s=[],a={},c=function(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(JSON.parse(i.responseText))},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:c,headers:{keys:function(){return o},entries:function(){return s},get:function(e){return a[e.toLowerCase()]},has:function(e){return e.toLowerCase()in a}}}};for(var u in i.open(t.method||"get",e,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,n){o.push(t=t.toLowerCase()),s.push([t,n]),a[t]=a[t]?a[t]+","+n:n})),n(c())},i.onerror=r,i.withCredentials="include"==t.credentials,t.headers)i.setRequestHeader(u,t.headers[u]);i.send(t.body||null)}))}n.d(t,{Z:function(){return r}})}},function(e){e.O(0,[2462,5923,7537],(function(){return t=53236,e(e.s=t);var t}));e.O()}]);